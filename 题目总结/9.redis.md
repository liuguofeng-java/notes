## Redis

##### Redis缓存雪崩、击穿、穿透

- 雪崩: 大量key集体到期，导致大量请求被数据库处理 
  - 解决:在redis存数据是加上随机数

- 击穿: 请求没有的数据redis返回null，导致一直请求数据库
  -  解决: 1.在请求参数上加限制,2.没有查到的数据也在redis中存上并且加上短过期时间

- 穿透: 第一次没有缓存,用户大量访问,导致大部分请求访问数据库 
  - 解决:加锁,第一个用户拿到数据并且让他再把数据存上redis上在释放锁



##### Redis 类型

- String：Redis中最基本的数据类型
- List：有序的、可重复的集合
- Hash：键值对，key无序、不可重复，value可重复
- Set：无序、不可重复的集合
- Zset：有序、不可重复的集合

##### Redis持久化

- `RDB`: 数据快照
  - 优点: `高性能`(通过fork子进程完成,不会影响主进程)、`备份文件比AOF小`(文件采用了一种高效的二进制格式)
  - 缺点: `数据可能损失`(RDB 是定期生成的快照文件)
- `AOF`：用于将 Redis 服务器的写操作以追加的方式记录到一个文本文件中，从而实现数据持久化。
  - 优点: `数据安全性高`(因为每次记录写操作)、`自动重写`(把不必要的命令自动删除)
  - 缺点: `体积大`(因为需要记录每次写操作命令)、`性能比RDB要差`



##### 怎么保证redis和数据库的数据一致性

- 双删延迟: 更新时先删除redis缓存，在更新数据库，延迟一段时间后再删除redis缓存
- 删除缓存重试:将第二次删除缓存的数据存储到消息队列中，由消费者来执行删除操作



##### redis过期删除策略：
- 惰性删除:获取key的时候去检查这个key有没有过期，如果过期的话直接删除
- 定时删除:每隔一段时间检查key有没有过期，删除过期key



##### 分布式锁:
- 使用redisson实验分布式锁，底层是setnx
- 在客户端获取锁时，可以设置一个超时时间，即锁的自动释放时间。这个超时时间通常是根据任务的预估执行时间来确定的，一般设置为任务执行时间的两倍或三倍。
