## sql

#### 1. SQL 优化

- 在程序中开启慢SQL日志，使用explain查看SQL执行情况，是否加索引，是否遵循对左匹配原则
- 正确的建立索引,常用字段和主键
- 少用 `in` `not in`  `>` `<`
- `like`  使用`like '%name'`或者`like '%name%'` 会导致全表扫描,但是使用 `like 'name%'`可以走索引
-  `or`只要一方没有索引,就会全表扫描, 解决:双方都建立索引
- `order by` 排序时,使用有索引的字段进行排序
- 不要在`where` 语句后进行计算操作
- select 语句务必指明字段名称，不要使用`*` 

#### 2.索引类型

- 普通索引：普通索引是最基本的索引，它没有任何限制，值可以为空；仅加速查询。
- 唯一索引：唯一索引与普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值
- 主键索引：主键索引是一种特殊的唯一索引，一个表只能有一个主键，不允许有空值。
- 组合索引：组合索引指在多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。使用组合索引时遵循最左前缀集合
- 全文索引：全文索引主要用来查找文本中的关键字，而不是直接与索引中的值相比较。fulltext索引跟其它索引大不相同，它更像是一个搜索引擎，而不是简单的where语句的参数匹配

#### 3.MyISAM 和 InnoDB 区别

- InnoDB 支持事务，MyISAM 不支持

- InnoDB 支持外键，而 MyISAM 不支持

- InnoDB是聚集索引，使用B+Tree作为索引结构，数据文件是和（主键）索引绑在一起的；MyISAM是非聚集索引，它也是使用B+Tree作为索引结构，但是索引和数据文件是分离的，索引保存的是数据文件的指针。

- InnoDB 必须要有主键，MyISAM可以没有主键；InnoDB 如果我们没有明确去指定创建主键索引。它会帮我们隐藏的生成一个 6 byte 的 int 型的索引作为主键索引。

- InnoDB辅助索引和主键索引之间存在层级关系；MyISAM辅助索引和主键索引则是平级关系。即：InnoDB 如果添加其他辅助索引，辅助索引查询就需要两次查询，先查询到主键，然后再通过主键查询到数据

- InnoDB支持表级锁、行级锁，默认为行级锁；而 MyISAM 仅支持表级锁。InnoDB 的行锁是实现在索引上的，而不是锁在物理行上。如果访问未命中索引，也是无法使用行锁，将会退化为表锁



#### 4.事务隔离级别

- 原子性（Atomicity）事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。

- 一致性（Consistency）事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。

- 隔离性（Isolation）同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。

- 持久性（Durability）事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。
  

| 名称       | 简介                                                         |
| ---------- | ------------------------------------------------------------ |
| 脏读       | 事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据 |
| 不可重复读 | 事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。 |
| 幻读       | 事务B前后两次读取同一个范围的数据，在事务B两次读取的过程中事务A新增了数据，导致事务B后一次读取到前一次查询没有看到的行。 |

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| 读未提交（read-uncommitted） | 是   | 是         | 是   |
| 不可重复读（read-committed） | 否   | 是         | 是   |
| 可重复读（repeatable-read）  | 否   | 否         | 是   |
| 串行化（serializable）       | 否   | 否         | 否   |









